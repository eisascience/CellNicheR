% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Support_Analysis_SIVScoring.R
\name{make_control_centers}
\alias{make_control_centers}
\title{Generate Matched Control ROI Centers}
\usage{
make_control_centers(
  meta,
  case_centers,
  r_mm = 0.05,
  n_controls = 2,
  density_tol = 0.2,
  plausible_col = "SIV_Plausible",
  attempts_per_case = 500,
  seed = 2025,
  min_sep = 0.05
)
}
\arguments{
\item{meta}{A data frame of per-cell metadata with:
\describe{
  \item{x_slide_mm}{Numeric x-coordinate (in mm).}
  \item{y_slide_mm}{Numeric y-coordinate (in mm).}
}}

\item{case_centers}{A data frame of case ROI centers with columns:
\describe{
  \item{x_slide_mm}{X-coordinate of ROI center (mm).}
  \item{y_slide_mm}{Y-coordinate of ROI center (mm).}
}}

\item{r_mm}{Numeric. ROI radius in millimeters; defines the neighborhood
used for density comparison and exclusion of nearby SIV-plausible regions.}

\item{n_controls}{Integer. Number of matched control centers to generate per case
center (default: 2).}

\item{density_tol}{Numeric fraction (default: 0.20). Tolerance for acceptable
differences in local cell density between case and control ROIs. For example,
\code{0.20} allows ±20% variation in the number of cells within \code{r_mm}.}

\item{plausible_col}{Character string specifying the column name in \code{meta}
that indicates SIV-plausible cells (default: \code{"SIV_Plausible"}).}

\item{attempts_per_case}{Integer (default: 500). Maximum number of random attempts
to find suitable control centers per case.}

\item{seed}{Integer random seed (default: 2025) for reproducibility.}

\item{min_sep}{Numeric. Minimum separation (in mm) between control centers to
prevent spatial overlap (default: \code{r_mm}).}
}
\value{
A data frame of control ROI centers with:
  \describe{
    \item{x_slide_mm, y_slide_mm}{Coordinates of each control ROI center.}
    \item{case_id}{ID of the matched case ROI.}
    \item{control_rank}{Numeric rank of control (1..n_controls).}
    \item{control_id}{Unique control ROI identifier.}
  }
}
\description{
Identifies control ROI centers that are spatially distant from SIV-plausible cells
but matched in local cell density to corresponding case ROIs. Each case ROI center
is used to select one or more nearby control centers that have similar neighborhood
density, ensuring comparable sampling for downstream case–control comparisons.
}
\details{
The algorithm randomly samples candidate positions from cells that are not
marked as SIV-plausible and are farther than \code{r_mm} from any plausible
cell. For each case center, it iteratively selects control centers whose local
cell density (number of cells within \code{r_mm}) falls within the tolerance
range of the corresponding case ROI. Candidates too close to an existing control
are excluded using the \code{min_sep} criterion.

If no valid control centers are found for a given case, the result will return
an empty data frame.
}
\examples{
meta <- data.frame(
  x_slide_mm = runif(500, 0, 2),
  y_slide_mm = runif(500, 0, 2),
  SIV_Plausible = sample(c(TRUE, FALSE), 500, TRUE)
)
case_centers <- data.frame(
  x_slide_mm = runif(5, 0.2, 1.8),
  y_slide_mm = runif(5, 0.2, 1.8)
)
ctrs <- make_control_centers(meta, case_centers, r_mm = 0.1, n_controls = 2)
head(ctrs)

}
\seealso{
\code{\link{select_hotspot_seeds}}, \code{\link{build_rois_fast}},
and \code{\link{summarize_rois}} for related ROI generation and summarization steps.
}
