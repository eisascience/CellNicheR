% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Support_Analysis_SIVScoring.R
\name{build_rois_fast}
\alias{build_rois_fast}
\title{Build ROIs Around Seed Centers (Fast Approximation)}
\usage{
build_rois_fast(meta, seed_df, r_mm = 0.05, label = "case")
}
\arguments{
\item{meta}{A data frame of per-cell metadata containing spatial coordinates and
other cell-level annotations. Must include:
\describe{
  \item{\code{x_slide_mm}}{Numeric x-coordinate (in mm).}
  \item{\code{y_slide_mm}}{Numeric y-coordinate (in mm).}
}}

\item{seed_df}{A data frame of ROI seed centers, with columns
\code{x_slide_mm} and \code{y_slide_mm}, specifying the ROI centers to be expanded.}

\item{r_mm}{Numeric. ROI radius in millimeters used to define the circular
neighborhood for each ROI (default: \code{0.05}).}

\item{label}{Character string defining the ROI type label to assign
(e.g., \code{"case"} or \code{"control"}; default: \code{"case"}).}
}
\value{
A data frame in “long” format containing all cells that fall within at least
  one ROI. Each row corresponds to a single cell and includes:
  \describe{
    \item{\code{roi_id}}{Unique ROI identifier (e.g., \code{"case_1"}).}
    \item{\code{roi_centerx}, \code{roi_centery}}{Coordinates of the ROI center.}
    \item{\code{roi_type}}{ROI label (e.g., \code{"case"} or \code{"control"}).}
    \item{\code{roi_radiusmm}}{Numeric radius used to define the ROI.}
  }
  The output also retains all columns from the input \code{meta} data frame
  corresponding to cells included within an ROI.
}
\description{
Efficiently constructs regions of interest (ROIs) by identifying all cells within
a specified radius (\code{r_mm}) around each provided seed (center) coordinate.
This implementation uses fast nearest-neighbor search via the \pkg{FNN} package
for scalable performance on large datasets.
}
\details{
This function leverages \pkg{FNN}’s \code{\link[FNN]{get.knnx}} to efficiently
compute nearest-neighbor distances between ROI centers and all cell coordinates.
Each cell within \code{r_mm} of a seed center is included in that ROI.

It provides a significant speed-up compared to pure R distance loops, particularly
for large spatial datasets typical of single-cell or spatial transcriptomic analyses.

A simple diagnostic scatter plot is generated by default, showing all cell
coordinates (gray) and ROI seed centers (red).
}
\examples{
meta <- data.frame(
  x_slide_mm = runif(1000, 0, 2),
  y_slide_mm = runif(1000, 0, 2)
)
seeds <- data.frame(
  x_slide_mm = c(0.5, 1.5),
  y_slide_mm = c(0.5, 1.5)
)
rois <- build_rois_fast(meta, seed_df = seeds, r_mm = 0.1, label = "case")
head(rois)

}
\seealso{
\code{\link{make_control_centers}}, \code{\link{select_hotspot_seeds}},
and \code{\link{summarize_rois}} for related ROI generation and analysis steps.
}
