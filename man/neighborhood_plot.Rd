% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Support_Analysis_SIVScoring.R
\name{neighborhood_plot}
\alias{neighborhood_plot}
\title{Plot a cell neighborhood around a cell of interest (COI)}
\usage{
neighborhood_plot(
  cell_meta,
  cell_polygons,
  expr_matrix = NULL,
  coi = NULL,
  k = 50,
  restrict_to_sample = TRUE,
  cluster_var = "RNA_Pre.Napari.v3.0.071825_Cell.Typing.InSituType.2_1_clusters",
  fill_by = c("VirusPos", "cluster", "SIVsum"),
  alpha_coi = 1,
  alpha_bg = 0.6,
  outline_coi = "black",
  outline_bg = "grey40",
  linewidth = 0.25,
  scale_bar_fun = make_scale_bar_r,
  seed = 2025
)
}
\arguments{
\item{cell_meta}{Data frame of per-cell metadata containing at least
`cell`, `CenterX_global_px`, and `CenterY_global_px`.}

\item{cell_polygons}{Data frame of per-cell polygon coordinates containing
`cell`, `x_global_px`, and `y_global_px`.}

\item{expr_matrix}{Optional numeric expression matrix (cells × features),
required if `SIVsum` is not present in `cell_meta`.}

\item{coi}{Character. Cell ID for the cell of interest. If `NULL`, the cell
with the highest `SIVsum` is selected automatically.}

\item{k}{Integer. Number of nearest neighbors to include (default: `50`).}

\item{restrict_to_sample}{Logical. If `TRUE`, restricts the neighborhood to
cells from the same `SampleID` (default: `TRUE`).}

\item{cluster_var}{Character. Column in `cell_meta` giving cluster or cell
type labels.}

\item{fill_by}{Character. Variable used to color polygons: one of
`"VirusPos"`, `"cluster"`, or `"SIVsum"`.}

\item{alpha_coi, alpha_bg}{Numeric transparency levels for the COI and
background cells.}

\item{outline_coi, outline_bg}{Colors for polygon outlines.}

\item{linewidth}{Numeric. Polygon border width.}

\item{scale_bar_fun}{Function generating a scale bar (default:
`make_scale_bar_r`). Use `NULL` to omit.}

\item{seed}{Integer. Random seed for reproducibility of any sampling steps.}
}
\value{
A `ggplot2` object showing the cell neighborhood polygons.
  The returned object includes attributes:
  \itemize{
    \item `"coi"` — the cell of interest ID.
    \item `"neighbors"` — vector of neighboring cell IDs.
  }
}
\description{
Builds a local spatial neighborhood view around a selected cell of interest
and its nearest neighbors. Polygon boundaries and metadata are joined to
visualize viral status, cell type, or expression summaries.
}
\details{
The function uses `FNN::get.knnx()` for efficient nearest-neighbor search in
global pixel coordinates. It automatically overlays a scale bar and adapts
fill colors based on the selected variable.
}
\examples{
p <- neighborhood_plot(cell_meta, cell_polygons, k = 50, fill_by = "VirusPos")
print(p)

}
